{% extends "base.html" %}

{% block content %}

<div class = 'container'>

  <meta name="csrf-token" content="{{ csrf_token }}" data-id = {{character.pk}}>

  <div class="character_title">
    <h1>{{character.character_class}}</h1>
    <img src="/static/img/Us_Marshal.png">
    <h2>{{character.character_name}}</h2>

    <div style="float: left;">
      <h3>Health</h3>
      <h4 id = "current_wounds">{{character.current_health}} / {{character.health}}</h4>
      <table>
        <tr>
          <td>
            <form method="post" id = "health+">
            {% csrf_token %}
            <button type="submit">+</button>
          </form>
          </td>
          <td>
            <form method="post" id = "health-">
            {% csrf_token %}
            <button type="submit">-</button>
          </form>
          </td>
        </tr>
      </table>
    </div>

    <div style="float: right;">
      <h3>Sanity</h3>
      <h4 id = "current_sanity">{{character.current_sanity}} / {{character.sanity}}</h4>
      <table>
        <tr>
          <td>
            <form method="post" id = "sanity+">
            {% csrf_token %}
            <button type="submit">+</button>
          </form>
          </td>
          <td>
            <form method="post" id = "sanity-" >
            {% csrf_token %}
            <button type="submit">-</button>
          </form>
          </td>
        </tr>
      </table>
    </div>

  </div>

  <div class = 'stat_info'>
    <table>
      <h1>Stats</h1>
      <tr> 
        <td>
          <h2>Agility</h2>
          <p>{{character.agility}}</p>
        </td>
        <td>
          <h2>Cunning</h2>
          <p>{{character.cunning}}</p>
        </td>
        <td>
          <h2>Spitit</h2>
          <p>{{character.spirit}}</p>
        </td>
      </tr>

      <tr style="text-align: center;"> 
        <td>
          <h2>Strength</h2>
          <p>{{character.strength}}</p>
        </td>
        <td>
          <h2>Lore</h2>
          <p>{{character.lore}}</p>
        </td>
        <td>
          <h2>Luck</h2>
          <p>{{character.luck}}</p>
        </td>
      </tr>
  </div>

  <div class = 'stat_info'>
  <table>
    <h1> Combat</h1>
    <tr> 
        <td>
          <h2>Range</h2>
          <p>{{character.range_to_hit}}+</p>
        </td>
        <td>
          <h2>Melee</h2>
          <p>{{character.melee_to_hit}}+</p>
        </td>
        <td>
          <h2>Comabt</h2>
          <p>{{character.combat}}</p>
        </td>
      </tr>

  </table>
  </div>

  <div class = 'abilites'>

    <h1> Class Ability</h1>
    <p>
      Double-Shot: Once per turn, when you kill an Enemy with a ShotGun, you gain +1 shot with that ShotGun
    </p>

    <h1> Passive Buffs </h1>
    {% for buff in character.passive_buffs.all %}

      <div style="border: solid black; padding: 4px">
        <h4> {{buff.name}} </h4>
        <p> {{buff.text}}</p>
      </div>
      
    {% endfor %}
  </div>
</div>

<script>
  // get csrf token for safty
  const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

  // get the primary key of the model
  const pk = document.querySelector('meta[name="csrf-token"]').getAttribute('data-id');

  // for sending post request to the model
  // data will be a dictionary of information, use the key for function to assign the logic
  async function Send_Data(Data) {

    //sending post request to character 
    let send_data = await fetch(`/characters/${pk}`,{
      headers: {
        'Content-Type':'application/json',
        'X-CSRFToken': csrfToken,},
      method : 'POST',
      body : JSON.stringify(Data
      )// body
    })//fetch function

    let send_json = await send_data.json()
    return send_json
  }


  async function Health_Data(Data) {
    
    let info = {}

    info["function"] = Data;
    
    data_dict = await Send_Data(info);

    health = data_dict["health"]

    document.getElementById("current_wounds").innerHTML = `${health} / {{character.health}}`
  }

  async function Sanity_Data(Data){
    //get the primary key
    let info = {}

    info["function"] = Data;
    
    data_dict = await Send_Data(info);

    sanity = data_dict["sanity"]

    document.getElementById("current_sanity").innerHTML = `${sanity} / {{character.sanity}}`
  }

  document.getElementById('health+').addEventListener('submit',async function(event){
    event.preventDefault();
     Health_Data('health+');
  })//health form function

  document.getElementById('health-').addEventListener('submit',async function(event){
    event.preventDefault();
     Health_Data('health-');
  })//health form function

  document.getElementById('sanity+').addEventListener('submit',async function(event){
    event.preventDefault();
     Sanity_Data('sanity+');
  })//health form function

   document.getElementById('sanity-').addEventListener('submit',async function(event){
    event.preventDefault();
     Sanity_Data('sanity-');
  })//health form function

</script>
{% endblock content %}

